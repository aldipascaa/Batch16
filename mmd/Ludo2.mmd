classDiagram

%% ===============================
%%            RELATIONSHIPS
%% ===============================

Game "1" --> "1" Board : uses
Game "1" --> "1" Dice : uses
Game "1" --> "n" Player : manages
Game "1" --> "1" IRuleEngine : rules

Player "1" --> "n" Pawn : owns
Player "1" --> "1" PlayerPath : receives from Board

Board "1" --> "52" Tile : MainTrack
Board "1" --> "n" Tile : StartTiles
Board "1" --> "n" Tile : HomeTiles
Board "1" --> "n" Tile : HomeEntryTiles
Board "1" --> "n" List~Tile~ : HomeStretches
Board "1" --> "n" PlayerPath : Paths (authority)

PlayerPath "1" --> "n" Tile : OrderedTiles

Pawn "1" --> "1" Tile : CurrentTile

Player ..> Color
Player ..> PlayerState
Pawn ..> PawnState
Pawn ..> Color
Tile ..> TileType
Game ..> GameState

%% ===============================
%%              CLASSES
%% ===============================

class Game {
    +GameState State
    +List<Player> Players
    +Board Board
    +Dice Dice
    +Player CurrentPlayer
    +int CurrentPlayerIndex
    +IRuleEngine RuleEngine

    +void Start()
    +void Reset()
    +void End()
    +void NextTurn()
    +int RollDice()
    +Tile MovePawn(Pawn pawn, int steps)
    +void PlacePawn(Pawn pawn, Tile tile)
    +void RemovePawn(Pawn pawn)
    +Player GetCurrentPlayer()
}

class Player {
    +Color Color
    +List<Pawn> Pawns
    +PlayerState State
    +PlayerPath Path   // Provided by Board

    +bool AllPawnsFinished()
    +List<Pawn> GetMovablePawns(int roll)
}

class Board {
    +List<Tile> MainTrack
    +Dictionary<Color, Tile> StartTiles
    +Dictionary<Color, Tile> HomeTiles
    +Dictionary<Color, Tile> HomeEntryTiles
    +Dictionary<Color, List<Tile>> HomeStretches
    +Dictionary<Color, PlayerPath> Paths

    +void BuildAllPlayerPaths(List<Player> players)
    +PlayerPath BuildPath(Color color)
    +PlayerPath GetPath(Color color)
}

class PlayerPath {
    +Color Color
    +List<Tile> OrderedTiles
    +int StartIndex

    +Tile GetTileAt(int index)
    +int Length()
}

class Pawn {
    +int ID
    +Color Color
    +PawnState State
    +Tile CurrentTile

    +bool IsHome()
    +bool IsActive()
    +bool IsComplete()
}

class Tile {
    +TileType Type
    +Pawn OccupiedBy

    +bool isOccupied()
    +bool isSafeZone()
}

class Dice {
    +int Sides
    +int Roll()
}

class IRuleEngine {
    <<interface>>
    +bool CanMove(Pawn pawn, int roll)
    +Tile GetDestination(Pawn pawn, int roll)
    +bool IsCapture(Tile tile)
    +bool HasPlayerWon(Player player)
}

%% ===============================
%%              ENUMS
%% ===============================

class GameState {
    <<Enumeration>>
    NotStarted
    Running
    Finished
}

class Color {
    <<Enumeration>>
    Red
    Blue
    Green
    Yellow
}

class PlayerState {
    <<Enumeration>>
    Active
    Won
}

class PawnState {
    <<Enumeration>>
    Home
    Active
    Complete
}

class TileType {
    <<Enumeration>>
    Start
    Normal
    Safe
    HomeEntry
    Home
}
